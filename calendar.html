<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ë¹µê³°ì´ ê·¼ë¬´í‘œ</title>
    <link rel="icon" href="https://postfiles.pstatic.net/MjAyNTEyMjZfMjgg/MDAxNzY2NzA1ODkxNDI4.jwR_hmBeX73gNUybaFzK1piDE3Dp6NPgib30YcaMvaQg.7BxiiFsCLAVzNkdQdORGL7WAVlKYT_a-_aaaIvT47gsg.PNG/image_1.png?type=w773" type="image/png">
    <style>
        :root {
            --primary: #4a90e2; --holiday: #ff6b6b; --sat-color: #1c7ed6; 
            --user-holiday-cell-bg: #f2fdf7; --user-holiday-text: #099268; 
            --border: #e9ecef; --am-color: #1971c2; --am-bg: #e7f5ff;
            --pm-color: #fd7e14; --pm-bg: #fff4e6; --bg-standard: #f8f9fa; --text-dark: #333;
        }

        body { font-family: 'Pretendard', -apple-system, sans-serif; background-color: var(--bg-standard); display: flex; flex-direction: column; align-items: center; padding: 10px; margin: 0; touch-action: pan-y; }
        .app-title { font-size: 1.6rem; font-weight: 800; color: var(--text-dark); margin: 10px 0; letter-spacing: -1px; display: flex; align-items: center; gap: 8px; }
        .app-logo { width: 45px; height: auto; }

        /* ë‹¬ë ¥ ìŠ¤íƒ€ì¼ */
        .calendar-container { width: 100%; max-width: 950px; background: white; border-radius: 15px; box-shadow: 0 5px 20px rgba(0,0,0,0.05); overflow: hidden; margin-bottom: 15px; user-select: none; }
        .header { display: flex; justify-content: space-between; align-items: center; padding: 12px 15px; background: #fff; border-bottom: 1px solid var(--border); }
        .month-selector { display: flex; gap: 4px; align-items: center; }
        .month-selector select { font-size: 1.1rem; font-weight: 800; color: var(--text-dark); border: none; background: transparent; cursor: pointer; outline: none; padding: 2px; border-radius: 5px; }
        .btn-today { background: #f1f3f5; color: var(--text-dark); border: 1px solid #dee2e6; padding: 4px 10px; border-radius: 6px; font-size: 0.75rem; font-weight: 700; cursor: pointer; margin-left: 4px; }
        .nav-buttons button { cursor: pointer; border: 1px solid #ddd; background: white; padding: 5px 12px; border-radius: 6px; font-weight: 600; font-size: 0.8rem; }
        .weekdays { display: grid; grid-template-columns: repeat(7, minmax(0, 1fr)); background: #fafbfc; border-bottom: 1px solid var(--border); }
        .weekday { text-align: center; padding: 8px 0; font-size: 0.7rem; color: #868e96; font-weight: bold; }
        .weekday:nth-child(1) { color: var(--holiday); }
        .weekday:nth-child(7) { color: var(--sat-color); }
        .calendar-grid { display: grid; grid-template-columns: repeat(7, minmax(0, 1fr)); grid-auto-rows: 82px; }
        .day-cell { border-right: 1px solid var(--border); border-bottom: 1px solid var(--border); padding: 3px 4px; cursor: pointer; display: flex; flex-direction: column; gap: 1px; min-width: 0; overflow: hidden; background: #fff; position: relative; }
        .day-cell:nth-child(7n) { border-right: none; }
        .user-holiday-active { background-color: var(--user-holiday-cell-bg) !important; }
        .day-num { font-size: 0.8rem; font-weight: 700; color: #495057; display: flex; align-items: center; min-height: 22px; }
        .today-circle { background: var(--text-dark); color: white !important; width: 20px; height: 20px; display: inline-flex; align-items: center; justify-content: center; border-radius: 50%; margin-left: -2px; font-size: 0.75rem; }
        .holiday-date { color: var(--holiday) !important; }
        .saturday-date { color: var(--sat-color) !important; }
        .holiday-name { font-size: 0.55rem; color: var(--holiday); white-space: nowrap; overflow: hidden; text-overflow: ellipsis; line-height: 1; margin-bottom: 1px; }
        .other-month { opacity: 0.2; }
        .item { font-size: 0.6rem; padding: 1px 2px; border-radius: 3px; font-weight: 700; text-align: center; white-space: normal; word-break: keep-all; line-height: 1; display: block; }
        .item-holiday { background: transparent; color: var(--user-holiday-text); border: 1px solid #c3fae8; }
        .item-am { background: var(--am-bg); color: var(--am-color); border: 1px solid #a5d8ff; }
        .item-pm { background: var(--pm-bg); color: var(--pm-color); border: 1px solid #ffd8a8; }
        .item-memo { color: #adb5bd; font-size: 0.55rem; font-style: normal; margin-top: auto; padding-top: 1px; border-top: 1px dashed #eee; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden; line-height: 1.1; word-break: break-all; }

        /* í†µê³„ ì¹´ë“œ */
        .stats-container { width: 100%; max-width: 950px; display: grid; grid-template-columns: repeat(3, 1fr); gap: 8px; }
        .stat-card { background: #fff; padding: 12px; border-radius: 12px; box-shadow: 0 4px 10px rgba(0,0,0,0.05); display: flex; flex-direction: column; gap: 4px; border: 1px solid #eee; border-left-width: 5px; min-width: 0; }
        .card-total { border-left-color: #343a40; }
        .card-am { border-left-color: var(--am-color); }
        .card-pm { border-left-color: var(--pm-color); }
        .stat-card h4 { margin: 0; font-size: 0.7rem; color: #868e96; font-weight: 700; }
        .stat-card .value { font-size: 1rem; font-weight: 800; color: var(--text-dark); } 
        .value-total-days { font-size: 0.75rem; font-weight: 600; color: #adb5bd; }
        .stat-card .sub-value { font-size: 0.65rem; color: #495057; font-weight: 500; word-break: keep-all; line-height: 1.2; }
        .highlight-holiday { color: var(--user-holiday-text); font-weight: bold; }

        /* ë²„ìŠ¤ ìš´í–‰í‘œ ì´ë¯¸ì§€ ì„¹ì…˜ */
        .bus-section { width: 100%; max-width: 950px; margin-top: 30px; background: white; border-radius: 15px; box-shadow: 0 5px 20px rgba(0,0,0,0.05); overflow: hidden; margin-bottom: 50px; cursor: pointer; border: 1px solid #eee; }
        .bus-section img { width: 100%; height: auto; display: block; }
        .bus-label { background: #343a40; color: white; text-align: center; padding: 8px; font-size: 0.8rem; font-weight: bold; }

        /* ê¸°íƒ€ UI */
        .data-management { width: 100%; max-width: 950px; margin-top: 20px; display: flex; gap: 10px; justify-content: center; }
        .btn-data { padding: 8px 15px; border-radius: 8px; border: 1px solid #ddd; background: #fff; font-size: 0.75rem; cursor: pointer; color: #666; }
        .toast { visibility: hidden; min-width: 200px; background-color: rgba(0,0,0,0.8); color: #fff; text-align: center; border-radius: 10px; padding: 12px; position: fixed; z-index: 200; left: 50%; bottom: 30px; transform: translateX(-50%); font-size: 0.9rem; }
        .toast.show { visibility: visible; animation: fadein 0.5s, fadeout 0.5s 2.5s; }
        @keyframes fadein { from { bottom: 0; opacity: 0; } to { bottom: 30px; opacity: 1; } }
        @keyframes fadeout { from { bottom: 30px; opacity: 1; } to { bottom: 0; opacity: 0; } }
        
        .modal-overlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.7); z-index: 99; backdrop-filter: blur(5px); cursor: pointer; }
        .modal-content { display: none; position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); background: white; padding: 30px; border-radius: 20px; box-shadow: 0 10px 50px rgba(0,0,0,0.3); z-index: 100; width: 85%; max-width: 340px; }
        
        /* ì´ë¯¸ì§€ í™•ëŒ€ ì „ìš© ìŠ¤íƒ€ì¼ */
        .image-modal-content { 
            display: none; position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); 
            z-index: 101; max-width: 95vw; max-height: 90vh; overflow: auto; 
            background: #fff; border-radius: 15px; padding: 5px; box-shadow: 0 0 30px rgba(0,0,0,0.5);
        }
        .image-modal-content img { width: 100%; height: auto; display: block; border-radius: 10px; }
    </style>
</head>
<body>

    <h1 class="app-title">
        <img src="https://postfiles.pstatic.net/MjAyNTEyMjZfMjgg/MDAxNzY2NzA1ODkxNDI4.jwR_hmBeX73gNUybaFzK1piDE3Dp6NPgib30YcaMvaQg.7BxiiFsCLAVzNkdQdORGL7WAVlKYT_a-_aaaIvT47gsg.PNG/image_1.png?type=w773" 
             alt="ë¡œê³ " class="app-logo" referrerpolicy="no-referrer">
        ë¹µê³°ì´ ê·¼ë¬´í‘œ
    </h1>

    <div class="calendar-container" id="swipeArea">
        <div class="header">
            <div class="nav-buttons"><button onclick="moveMonth(-1)">â—€</button></div>
            <div class="month-selector">
                <select id="yearSelect" onchange="jumpToDate()"></select>
                <select id="monthSelect" onchange="jumpToDate()"></select>
                <button onclick="jumpToToday()" class="btn-today">ì˜¤ëŠ˜</button>
            </div>
            <div class="nav-buttons"><button onclick="moveMonth(1)">â–¶</button></div>
        </div>
        <div class="weekdays"><div class="weekday">ì¼</div><div class="weekday">ì›”</div><div class="weekday">í™”</div><div class="weekday">ìˆ˜</div><div class="weekday">ëª©</div><div class="weekday">ê¸ˆ</div><div class="weekday">í† </div></div>
        <div class="calendar-grid" id="grid"></div>
    </div>

    <div class="stats-container">
        <div class="stat-card card-total"><h4 id="statMonthTitle">ê·¼ë¬´ í˜„í™©</h4><div class="value" id="statTotalDaysValue">ì´ 0ì¼ <span class="value-total-days">/ 0ì¼</span></div><div class="sub-value" id="statHolidayDetail">íœ´ì¼: <span class="highlight-holiday">0ì¼</span></div></div>
        <div class="stat-card card-am"><h4>ì˜¤ì „ë°˜</h4><div class="value" id="statAMTotal">0ì¼</div><div class="sub-value" id="statAMDetail">2íšŒ:0, 3íšŒ:0</div></div>
        <div class="stat-card card-pm"><h4>ì˜¤í›„ë°˜</h4><div class="value" id="statPMTotal">0ì¼</div><div class="sub-value" id="statPMDetail">2íšŒ:0, 3íšŒ:0</div></div>
    </div>

    <div class="data-management">
        <button class="btn-data" onclick="exportData()">ë°ì´í„° ì½”ë“œ ë³µì‚¬</button>
        <button class="btn-data" onclick="openImportModal()">ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸°</button>
    </div>

    <div class="bus-section" onclick="showImageModal()">
        <div class="bus-label">ğŸšŒ 4103ë²ˆ ìš´í–‰ ì‹œê°„í‘œ (í´ë¦­ ì‹œ í™•ëŒ€)</div>
        <img src="https://postfiles.pstatic.net/MjAyNjAxMjZfMTc4/MDAxNzY5Mzg2NDA4MDI5.mq4irpDcDk4GvxGSxGcyXqlDD14PvZMDPQ_18B7JSQog.vyg12ghm0NP-lrm-1pevy50oN6Gf8Q_ARw4bi3IxqFcg.PNG/IMG_3701.PNG?type=w773" alt="4103ë²ˆ ë²„ìŠ¤ ìš´í–‰ ì‹œê°„í‘œ">
    </div>

    <div id="toast" class="toast"></div>
    <div class="modal-overlay" id="overlay" onclick="closeAllModals()"></div>
    
    <div class="modal-content" id="modal" style="display:none; position:fixed; top:50%; left:50%; transform:translate(-50%, -50%); background:white; padding:30px; border-radius:20px; z-index:100; width:85%; max-width:340px;">
        <h3 id="modalDate" style="margin:0 0 15px 0;">ë‚ ì§œ ì„ íƒ</h3>
        <div style="margin-bottom:20px;"><label style="display:flex; align-items:center; cursor:pointer;"><input type="checkbox" id="isHoliday" onchange="updateButtons()" style="width:20px; height:20px; margin-right:10px;"> ğŸŒ´ íœ´ì¼ ì²´í¬</label></div>
        <div style="margin-bottom:20px;"><label>ê·¼ë¬´ íƒ€ì„</label><div style="display:flex; gap:8px;"><button class="btn-toggle" id="shiftAM" onclick="setShift('ì˜¤ì „')" style="flex:1; padding:12px; border:1px solid #ddd; border-radius:10px;">ì˜¤ì „</button><button class="btn-toggle" id="shiftPM" onclick="setShift('ì˜¤í›„')" style="flex:1; padding:12px; border:1px solid #ddd; border-radius:10px;">ì˜¤í›„</button></div></div>
        <div style="margin-bottom:20px;"><label>ì—…ë¬´ íšŸìˆ˜</label><div style="display:flex; gap:8px;"><button class="btn-toggle" id="tang2" onclick="setTang(2)" style="flex:1; padding:12px; border:1px solid #ddd; border-radius:10px;">2íšŒ</button><button class="btn-toggle" id="tang3" onclick="setTang(3)" style="flex:1; padding:12px; border:1px solid #ddd; border-radius:10px;">3íšŒ</button></div></div>
        <div style="margin-bottom:20px;"><label>ë©”ëª¨</label><textarea id="memo" rows="2" style="width:100%; padding:10px; border-radius:10px; border:1px solid #ddd;"></textarea></div>
        <button onclick="save()" style="width:100%; background:var(--text-dark); color:white; border:none; padding:15px; border-radius:10px; font-weight:bold;">ì €ì¥ ì™„ë£Œ</button>
    </div>
    
    <div class="modal-content" id="importModal" style="display:none; position:fixed; top:50%; left:50%; transform:translate(-50%, -50%); background:white; padding:30px; border-radius:20px; z-index:100; width:85%; max-width:340px;">
        <h3>ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸°</h3>
        <textarea id="importArea" rows="6" style="width:100%; margin-bottom:15px; padding:10px; border:1px solid #ddd;"></textarea>
        <button onclick="executeImport()" style="width:100%; background:var(--text-dark); color:white; padding:15px; border-radius:10px; font-weight:bold;">ê°€ì ¸ì˜¤ê¸°</button>
    </div>

    <div class="image-modal-content" id="imageModal" onclick="closeAllModals()">
        <img src="https://postfiles.pstatic.net/MjAyNjAxMjZfMTc4/MDAxNzY5Mzg2NDA4MDI5.mq4irpDcDk4GvxGSxGcyXqlDD14PvZMDPQ_18B7JSQog.vyg12ghm0NP-lrm-1pevy50oN6Gf8Q_ARw4bi3IxqFcg.PNG/IMG_3701.PNG?type=w773" alt="4103ë²ˆ ë²„ìŠ¤ ìš´í–‰ ì‹œê°„í‘œ í™•ëŒ€">
    </div>

<script>
    let viewDate = new Date();
    const STORAGE_KEY = 'bbanggom_stable_data';
    let db = JSON.parse(localStorage.getItem(STORAGE_KEY)) || {};
    let activeKey = "", selectedShift = null, selectedTang = null;

    const baseHolidays = {
        "2025-01-01":"ì‹ ì •","2025-01-29":"ì„¤ë‚ ","2025-03-01":"ì‚¼ì¼ì ˆ","2025-05-05":"ì–´ë¦°ì´ë‚ ","2025-12-25":"í¬ë¦¬ìŠ¤ë§ˆìŠ¤",
        "2026-01-01":"ì‹ ì •","2026-02-17":"ì„¤ë‚ ","2026-03-01":"ì‚¼ì¼ì ˆ","2026-05-05":"ì–´ë¦°ì´ë‚ ","2026-05-24":"ë¶€ì²˜ë‹˜ì˜¤ì‹ ë‚ ","2026-06-06":"í˜„ì¶©ì¼","2026-08-15":"ê´‘ë³µì ˆ","2026-09-25":"ì¶”ì„","2026-10-03":"ê°œì²œì ˆ","2026-10-09":"í•œê¸€ë‚ ","2026-12-25":"í¬ë¦¬ìŠ¤ë§ˆìŠ¤",
        "2027-02-07":"ì„¤ë‚ ","2027-05-13":"ë¶€ì²˜ë‹˜ì˜¤ì‹ ë‚ ","2027-09-15":"ì¶”ì„","2027-12-25":"í¬ë¦¬ìŠ¤ë§ˆìŠ¤",
        "2028-01-27":"ì„¤ë‚ ","2028-05-02":"ë¶€ì²˜ë‹˜ì˜¤ì‹ ë‚ ","2028-10-03":"ì¶”ì„/ê°œì²œì ˆ","2028-12-25":"í¬ë¦¬ìŠ¤ë§ˆìŠ¤",
        "2029-02-13":"ì„¤ë‚ ","2029-05-20":"ë¶€ì²˜ë‹˜ì˜¤ì‹ ë‚ ","2029-09-22":"ì¶”ì„","2029-12-25":"í¬ë¦¬ìŠ¤ë§ˆìŠ¤",
        "2030-02-03":"ì„¤ë‚ ","2030-05-09":"ë¶€ì²˜ë‹˜ì˜¤ì‹ ë‚ ","2030-09-12":"ì¶”ì„","2030-12-25":"í¬ë¦¬ìŠ¤ë§ˆìŠ¤"
    };

    function initSelects(year, month) {
        const ySel = document.getElementById('yearSelect'), mSel = document.getElementById('monthSelect');
        ySel.innerHTML = ''; mSel.innerHTML = '';
        for (let y = 2025; y <= 2030; y++) {
            const opt = document.createElement('option'); opt.value = y; opt.innerText = `${y}ë…„`;
            if (y === year) opt.selected = true; ySel.appendChild(opt);
        }
        for (let m = 1; m <= 12; m++) {
            const opt = document.createElement('option'); opt.value = m - 1; opt.innerText = `${m}ì›”`;
            if (m - 1 === month) opt.selected = true; mSel.appendChild(opt);
        }
    }

    function jumpToDate() { viewDate = new Date(parseInt(document.getElementById('yearSelect').value), parseInt(document.getElementById('monthSelect').value), 1); render(); }
    function jumpToToday() { viewDate = new Date(); render(); }

    function render() {
        const grid = document.getElementById('grid'); grid.innerHTML = '';
        const year = viewDate.getFullYear(), month = viewDate.getMonth(), lastDate = new Date(year, month + 1, 0).getDate(), realToday = new Date(); 
        initSelects(year, month);
        const firstDay = new Date(year, month, 1).getDay();
        const totalCells = (firstDay + lastDate) > 35 ? 42 : 35;
        const startDate = new Date(year, month, 1); startDate.setDate(startDate.getDate() - firstDay);
        let s = { total: 0, holiday: 0, am: 0, am2: 0, am3: 0, pm: 0, pm2: 0, pm3: 0 };

        for (let i = 0; i < totalCells; i++) {
            const date = new Date(startDate); date.setDate(startDate.getDate() + i);
            const key = `${date.getFullYear()}-${String(date.getMonth()+1).padStart(2,'0')}-${String(date.getDate()).padStart(2,'0')}`;
            const isThisMonth = date.getMonth() === month;
            const isToday = date.getFullYear() === realToday.getFullYear() && date.getMonth() === realToday.getMonth() && date.getDate() === realToday.getDate();
            const cell = document.createElement('div'); cell.className = `day-cell ${isThisMonth ? '' : 'other-month'}`;
            const holidayName = baseHolidays[key];
            let dateClass = 'day-num' + (holidayName || date.getDay() === 0 ? ' holiday-date' : date.getDay() === 6 ? ' saturday-date' : '');
            let content = `<div class="${dateClass}">${isToday ? `<span class="today-circle">${date.getDate()}</span>` : date.getDate()}</div>`;
            if (holidayName) content += `<div class="holiday-name">${holidayName}</div>`;
            if (db[key]) {
                const data = db[key];
                if (isThisMonth) {
                    if (data.isHoliday) s.holiday++; else if (data.shift) {
                        s.total++; if (data.shift === 'ì˜¤ì „') { s.am++; if (data.count == 2) s.am2++; else if (data.count == 3) s.am3++; }
                        else { s.pm++; if (data.count == 2) s.pm2++; else if (data.count == 3) s.pm3++; }
                    }
                }
                if (data.isHoliday) { cell.classList.add('user-holiday-active'); content += `<div class="item item-holiday">ğŸŒ´ íœ´ì¼</div>`; }
                else if (data.shift) { content += `<div class="item ${data.shift === 'ì˜¤ì „' ? 'item-am' : 'item-pm'}">${data.shift} ${data.count}íšŒ</div>`; }
                if (data.memo) content += `<div class="item-memo">${data.memo}</div>`;
            }
            cell.innerHTML = content; cell.onclick = () => openEditModal(key); grid.appendChild(cell);
        }
        document.getElementById('statMonthTitle').innerText = `${year}ë…„ ${month + 1}ì›”`;
        document.getElementById('statTotalDaysValue').innerHTML = `ì´ ${s.total}ì¼ <span class="value-total-days">/ ${lastDate}ì¼</span>`;
        document.getElementById('statHolidayDetail').innerHTML = `íœ´ì¼: <span class="highlight-holiday">${s.holiday}ì¼</span>`;
        document.getElementById('statAMTotal').innerText = `${s.am}ì¼`; document.getElementById('statAMDetail').innerText = `2íšŒ:${s.am2}, 3íšŒ:${s.am3}`;
        document.getElementById('statPMTotal').innerText = `${s.pm}ì¼`; document.getElementById('statPMDetail').innerText = `2íšŒ:${s.pm2}, 3íšŒ:${s.pm3}`;
    }

    let touchstartX = 0; let touchendX = 0;
    const swipeArea = document.getElementById('swipeArea');
    swipeArea.addEventListener('touchstart', e => { touchstartX = e.changedTouches[0].screenX; }, {passive: true});
    swipeArea.addEventListener('touchend', e => { touchendX = e.changedTouches[0].screenX; handleGesture(); }, {passive: true});
    function handleGesture() {
        const threshold = 50;
        if (touchendX < touchstartX - threshold) moveMonth(1);
        if (touchendX > touchstartX + threshold) moveMonth(-1);
    }

    function openEditModal(k) {
        activeKey = k; const data = db[k] || { isHoliday: false, shift: null, count: null, memo: '' };
        document.getElementById('modalDate').innerText = k; document.getElementById('isHoliday').checked = data.isHoliday;
        document.getElementById('memo').value = data.memo; selectedShift = data.shift; selectedTang = data.count;
        updateButtons(); document.getElementById('overlay').style.display = 'block'; document.getElementById('modal').style.display = 'block';
    }
    function openImportModal() { document.getElementById('importArea').value = ""; document.getElementById('overlay').style.display = 'block'; document.getElementById('importModal').style.display = 'block'; }
    function showImageModal() { document.getElementById('overlay').style.display = 'block'; document.getElementById('imageModal').style.display = 'block'; }
    function closeAllModals() { document.getElementById('overlay').style.display = 'none'; document.getElementById('modal').style.display = 'none'; document.getElementById('importModal').style.display = 'none'; document.getElementById('imageModal').style.display = 'none'; }
    function showToast(m) { const t = document.getElementById("toast"); t.innerText = m; t.className = "toast show"; setTimeout(() => t.className = "toast", 3000); }

    function exportData() {
        try {
            const jsonStr = JSON.stringify(db);
            const bytes = new TextEncoder().encode(jsonStr);
            const base64 = btoa(String.fromCharCode(...bytes));
            const tempInput = document.createElement("textarea");
            tempInput.value = base64; document.body.appendChild(tempInput);
            tempInput.select(); document.execCommand("copy");
            document.body.removeChild(tempInput);
            showToast('ë°ì´í„° ì½”ë“œê°€ ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!');
        } catch (e) { alert('ë³µì‚¬ ì‹¤íŒ¨'); }
    }

    function executeImport() {
        let code = document.getElementById('importArea').value.replace(/[^A-Za-z0-9+/=]/g, "");
        if (!code) return;
        try {
            const binary = atob(code);
            const bytes = new Uint8Array(binary.length);
            for (let i = 0; i < binary.length; i++) bytes[i] = binary.charCodeAt(i);
            const jsonStr = new TextDecoder().decode(bytes);
            const imported = JSON.parse(jsonStr);
            if (confirm('ë°ì´í„°ë¥¼ ë®ì–´ì“°ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                db = imported; localStorage.setItem(STORAGE_KEY, JSON.stringify(db));
                render(); closeAllModals(); showToast('ë¶ˆëŸ¬ì˜¤ê¸° ì„±ê³µ!');
            }
        } catch (e) { alert('ìœ íš¨í•˜ì§€ ì•Šì€ ì½”ë“œì…ë‹ˆë‹¤.'); }
    }

    function setShift(v) { selectedShift = (selectedShift === v) ? null : v; updateButtons(); }
    function setTang(v) { selectedTang = (selectedTang === v) ? null : v; updateButtons(); }
    function updateButtons() {
        const isH = document.getElementById('isHoliday').checked;
        if (isH) { selectedShift = null; selectedTang = null; }
        const btns = ['shiftAM', 'shiftPM', 'tang2', 'tang3'];
        btns.forEach(id => {
            const b = document.getElementById(id);
            b.disabled = isH;
            b.style.backgroundColor = (
                (id==='shiftAM' && selectedShift==='ì˜¤ì „') ? 'var(--primary)' : 
                (id==='shiftPM' && selectedShift==='ì˜¤í›„') ? 'var(--pm-color)' :
                (id.includes('tang') && ((id==='tang2' && selectedTang===2) || (id==='tang3' && selectedTang===3))) ? 'var(--text-dark)' : '#fff'
            );
            b.style.color = (b.style.backgroundColor === 'rgb(255, 255, 255)' || b.style.backgroundColor === '#fff') ? '#333' : '#fff';
        });
    }
    function save() {
        db[activeKey] = { isHoliday: document.getElementById('isHoliday').checked, shift: selectedShift, count: selectedTang, memo: document.getElementById('memo').value };
        localStorage.setItem(STORAGE_KEY, JSON.stringify(db));
        render(); closeAllModals();
    }
    function moveMonth(o) { viewDate.setMonth(viewDate.getMonth() + o); render(); }
    render();
</script>
</body>
</html>
