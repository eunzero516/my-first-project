<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë¹µê³°ì´ ê·¼ë¬´í‘œ</title>
    <style>
        :root {
            --primary: #4a90e2;
            --holiday: #ff6b6b;
            --border: #e9ecef;
            --am-color: #1971c2;
            --pm-color: #fd7e14;
            --bg: #f8f9fa;
            --text-dark: #333;
        }

        body { font-family: 'Pretendard', -apple-system, sans-serif; background-color: var(--bg); display: flex; flex-direction: column; align-items: center; padding: 10px; margin: 0; }
        
        .app-title { font-size: 1.6rem; font-weight: 800; color: var(--text-dark); margin: 10px 0; letter-spacing: -1px; display: flex; align-items: center; gap: 8px; }

        .calendar-container { 
            width: 100%; 
            max-width: 950px; 
            background: white; 
            border-radius: 15px; 
            box-shadow: 0 5px 20px rgba(0,0,0,0.05); 
            overflow: hidden; 
            margin-bottom: 15px;
        }
        
        .header { display: flex; justify-content: space-between; align-items: center; padding: 12px 15px; background: #fff; }
        .header h2 { margin: 0; font-size: 1.1rem; color: var(--text-dark); }
        .nav-buttons button { cursor: pointer; border: 1px solid #ddd; background: white; padding: 5px 10px; border-radius: 6px; font-weight: 600; font-size: 0.75rem; }

        .weekdays { 
            display: grid; 
            grid-template-columns: repeat(7, minmax(0, 1fr)); 
            background: #fafbfc; 
            border-top: 1px solid var(--border); 
            border-bottom: 1px solid var(--border); 
        }
        .weekday { text-align: center; padding: 8px 0; font-size: 0.7rem; color: #868e96; font-weight: bold; }
        .weekday:nth-child(1) { color: var(--holiday); }
        .weekday:nth-child(7) { color: var(--primary); }

        /* í–‰ ë†’ì´ë¥¼ 110px -> 88pxë¡œ íƒ€ì´íŠ¸í•˜ê²Œ ì¡°ì • */
        .calendar-grid { 
            display: grid; 
            grid-template-columns: repeat(7, minmax(0, 1fr)); 
            grid-auto-rows: 88px; 
        }

        .day-cell { 
            border-right: 1px solid var(--border); 
            border-bottom: 1px solid var(--border); 
            padding: 4px; 
            cursor: pointer; 
            display: flex;
            flex-direction: column;
            gap: 2px;
            min-width: 0; 
            overflow: hidden; 
            background: #fff;
        }
        .day-cell:nth-child(7n) { border-right: none; }
        .day-cell:hover { background: #f8f9fa; }
        
        .day-num { font-size: 0.8rem; font-weight: 700; color: #495057; }
        .other-month { opacity: 0.2; }

        /* ê·¼ë¬´ í•­ëª©: ì¤„ë°”ê¿ˆ í—ˆìš© */
        .item { 
            font-size: 0.62rem; 
            padding: 1px 3px; 
            border-radius: 3px; 
            font-weight: 700; 
            text-align: center;
            white-space: normal; 
            word-break: keep-all; 
            line-height: 1.1;
            display: block;
        }
        .item-holiday { background: #fff5f5; color: #fa5252; border: 1px solid #ffc9c9; }
        .item-am { background: #e7f5ff; color: var(--am-color); border: 1px solid #a5d8ff; }
        .item-pm { background: #fff4e6; color: var(--pm-color); border: 1px solid #ffd8a8; }

        /* ë©”ëª¨: ìµœëŒ€ 2ì¤„ê¹Œì§€ í‘œì‹œë˜ë„ë¡ ìˆ˜ì • */
        .item-memo { 
            color: #adb5bd; 
            font-size: 0.58rem; 
            font-style: italic; 
            margin-top: auto; 
            padding-top: 1px;
            border-top: 1px dashed #eee;
            /* 2ì¤„ ì œí•œ ì„¤ì • */
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
            line-height: 1.2;
            word-break: break-all;
        }

        /* í™”ì´íŠ¸ í†µê³„ ì¹´ë“œ */
        .stats-container { width: 100%; max-width: 950px; display: grid; grid-template-columns: 1fr; gap: 10px; }
        @media (min-width: 600px) { .stats-container { grid-template-columns: repeat(3, 1fr); } }
        
        .stat-card { 
            background: #fff;
            padding: 15px; 
            border-radius: 12px; 
            box-shadow: 0 4px 10px rgba(0,0,0,0.05); 
            display: flex;
            flex-direction: column;
            gap: 5px;
            border: 1px solid #eee;
        }
        
        .card-total { border-left: 5px solid #343a40; }
        .card-am { border-left: 5px solid var(--am-color); }
        .card-pm { border-left: 5px solid var(--pm-color); }
        
        .stat-card h4 { margin: 0; font-size: 0.75rem; color: #868e96; font-weight: 700; }
        .stat-card .value { font-size: 1.2rem; font-weight: 800; color: var(--text-dark); }
        .stat-card .sub-value { font-size: 0.75rem; color: #495057; font-weight: 500; }
        .highlight-holiday { color: var(--holiday); font-weight: bold; }

        /* ëª¨ë‹¬ ìŠ¤íƒ€ì¼ */
        #modal { display: none; position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); background: white; padding: 25px; border-radius: 20px; box-shadow: 0 10px 50px rgba(0,0,0,0.3); z-index: 100; width: 85%; max-width: 320px; }
        .overlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.4); z-index: 99; backdrop-filter: blur(3px); }
        .form-group { margin-bottom: 15px; }
        .form-group label { display: block; margin-bottom: 8px; font-weight: bold; font-size: 0.9rem; }
        textarea { width: 100%; padding: 10px; border: 1px solid #dee2e6; border-radius: 10px; font-size: 0.9rem; resize: none; box-sizing: border-box; }
        .btn-toggle-group { display: flex; gap: 6px; }
        .btn-toggle { flex: 1; padding: 10px; border: 1px solid #dee2e6; border-radius: 8px; background: white; cursor: pointer; font-weight: bold; font-size: 0.85rem; }
        .btn-toggle.active-blue { background: var(--primary); color: white; border-color: var(--primary); }
        .btn-toggle.active-orange { background: var(--pm-color); color: white; border-color: var(--pm-color); }
        .btn-toggle.active-gray { background: var(--text-dark); color: white; border-color: var(--text-dark); }
        .btn-toggle:disabled { opacity: 0.2; cursor: not-allowed; }
        .btn-save { width: 100%; background: var(--text-dark); color: white; border: none; padding: 12px; border-radius: 8px; font-weight: bold; font-size: 1rem; margin-top: 10px; cursor: pointer; }
    </style>
</head>
<body>

    <h1 class="app-title">ğŸ§¸ ë¹µê³°ì´ ê·¼ë¬´í‘œ</h1>

    <div class="calendar-container">
        <div class="header">
            <h2 id="monthDisplay"></h2>
            <div class="nav-buttons">
                <button onclick="moveMonth(-1)">â—€ ì´ì „</button>
                <button onclick="moveMonth(1)">ë‹¤ìŒ â–¶</button>
            </div>
        </div>
        <div class="weekdays">
            <div class="weekday">ì¼</div><div class="weekday">ì›”</div><div class="weekday">í™”</div>
            <div class="weekday">ìˆ˜</div><div class="weekday">ëª©</div><div class="weekday">ê¸ˆ</div>
            <div class="weekday">í† </div>
        </div>
        <div class="calendar-grid" id="grid"></div>
    </div>

    <div class="stats-container">
        <div class="stat-card card-total">
            <h4>ê·¼ë¬´ í˜„í™©</h4>
            <div class="value">ì´ <span id="statTotalDays">0</span>ì¼ ê·¼ë¬´</div>
            <div class="sub-value" id="statHolidayDetail">íœ´ì¼ <span class="highlight-holiday">0ì¼</span></div>
        </div>
        <div class="stat-card card-am">
            <h4>ì˜¤ì „ë°˜ ìƒì„¸</h4>
            <div class="value" id="statAMTotal">0ì¼</div>
            <div class="sub-value" id="statAMDetail">2íƒ•: 0ì¼, 3íƒ•: 0ì¼</div>
        </div>
        <div class="stat-card card-pm">
            <h4>ì˜¤í›„ë°˜ ìƒì„¸</h4>
            <div class="value" id="statPMTotal">0ì¼</div>
            <div class="sub-value" id="statPMDetail">2íƒ•: 0ì¼, 3íƒ•: 0ì¼</div>
        </div>
    </div>

    <div class="overlay" id="overlay" onclick="closeModal()"></div>
    <div id="modal">
        <h3 id="modalDate" style="margin: 0 0 15px 0; font-size: 1.1rem;">ë‚ ì§œ ì„ íƒ</h3>
        <div class="form-group">
            <label style="display: flex; align-items: center; cursor: pointer;">
                <input type="checkbox" id="isHoliday" onchange="updateButtons()" style="width: 18px; height: 18px; margin-right: 10px;"> ğŸŒ´ íœ´ì¼ ì²´í¬
            </label>
        </div>
        <div class="form-group">
            <label id="shiftLabel">ê·¼ë¬´ íƒ€ì„</label>
            <div class="btn-toggle-group">
                <button class="btn-toggle" id="shiftAM" onclick="setShift('ì˜¤ì „')">ì˜¤ì „</button>
                <button class="btn-toggle" id="shiftPM" onclick="setShift('ì˜¤í›„')">ì˜¤í›„</button>
            </div>
        </div>
        <div class="form-group">
            <label id="tangLabel">ì—…ë¬´ íšŸìˆ˜</label>
            <div class="btn-toggle-group">
                <button class="btn-toggle" id="tang2" onclick="setTang(2)">2íƒ•</button>
                <button class="btn-toggle" id="tang3" onclick="setTang(3)">3íƒ•</button>
            </div>
        </div>
        <div class="form-group">
            <label>ë©”ëª¨</label>
            <textarea id="memo" rows="2"></textarea>
        </div>
        <button class="btn-save" onclick="save()">ì €ì¥ ì™„ë£Œ</button>
    </div>

<script>
    let viewDate = new Date();
    // ë°ì´í„° ë³´ì¡´ ë²„ì „ ì—…ë°ì´íŠ¸ V12
    let db = JSON.parse(localStorage.getItem('bbanggomWorkLogV12') || '{}');
    let activeKey = "";
    let selectedShift = null;
    let selectedTang = null;

    function render() {
        const grid = document.getElementById('grid');
        grid.innerHTML = '';
        const year = viewDate.getFullYear();
        const month = viewDate.getMonth();
        document.getElementById('monthDisplay').innerText = `${year}ë…„ ${month + 1}ì›”`;
        
        const firstDay = new Date(year, month, 1).getDay();
        const lastDate = new Date(year, month + 1, 0).getDate();
        
        const totalDaysNeeded = firstDay + lastDate;
        const totalCells = totalDaysNeeded > 35 ? 42 : 35; 

        const startDate = new Date(year, month, 1);
        startDate.setDate(startDate.getDate() - firstDay);

        let stats = { total: 0, holiday: 0, am: 0, am2: 0, am3: 0, pm: 0, pm2: 0, pm3: 0 };

        for (let i = 0; i < totalCells; i++) {
            const date = new Date(startDate);
            date.setDate(startDate.getDate() + i);
            const key = `${date.getFullYear()}-${String(date.getMonth()+1).padStart(2,'0')}-${String(date.getDate()).padStart(2,'0')}`;
            const isThisMonth = date.getMonth() === month;
            
            const cell = document.createElement('div');
            cell.className = `day-cell ${isThisMonth ? '' : 'other-month'}`;
            let content = `<div class="day-num">${date.getDate()}</div>`;

            if (db[key]) {
                const data = db[key];
                if (isThisMonth) {
                    if (data.isHoliday) stats.holiday++;
                    else if (data.shift) {
                        stats.total++;
                        if (data.shift === 'ì˜¤ì „') {
                            stats.am++;
                            if (data.count == 2) stats.am2++; else if (data.count == 3) stats.am3++;
                        } else {
                            stats.pm++;
                            if (data.count == 2) stats.pm2++; else if (data.count == 3) stats.pm3++;
                        }
                    }
                }
                if (data.isHoliday) content += `<div class="item item-holiday">ğŸŒ´ íœ´ì¼</div>`;
                else if (data.shift) {
                    const shiftClass = data.shift === 'ì˜¤ì „' ? 'item-am' : 'item-pm';
                    content += `<div class="item ${shiftClass}">${data.shift} ${data.count}íƒ•</div>`;
                }
                if (data.memo) content += `<div class="item-memo">${data.memo}</div>`;
            }
            cell.innerHTML = content;
            cell.onclick = () => openModal(key);
            grid.appendChild(cell);
        }
        updateStatsUI(stats);
    }

    function updateStatsUI(s) {
        document.getElementById('statTotalDays').innerText = s.total;
        document.getElementById('statHolidayDetail').innerHTML = `íœ´ì¼ <span class="highlight-holiday">${s.holiday}ì¼</span>`;
        document.getElementById('statAMTotal').innerText = `${s.am}ì¼`;
        document.getElementById('statAMDetail').innerText = `2íƒ•: ${s.am2}, 3íƒ•: ${s.am3}`;
        document.getElementById('statPMTotal').innerText = `${s.pm}ì¼`;
        document.getElementById('statPMDetail').innerText = `2íƒ•: ${s.pm2}, 3íƒ•: ${s.pm3}`;
    }

    function setShift(val) { selectedShift = (selectedShift === val) ? null : val; updateButtons(); }
    function setTang(val) { selectedTang = (selectedTang === val) ? null : val; updateButtons(); }

    function updateButtons() {
        const isHoliday = document.getElementById('isHoliday').checked;
        if (isHoliday) { selectedShift = null; selectedTang = null; }
        const btns = [document.getElementById('shiftAM'), document.getElementById('shiftPM'), document.getElementById('tang2'), document.getElementById('tang3')];
        btns.forEach(btn => btn.disabled = isHoliday);
        document.getElementById('shiftAM').className = 'btn-toggle' + (selectedShift === 'ì˜¤ì „' ? ' active-blue' : '');
        document.getElementById('shiftPM').className = 'btn-toggle' + (selectedShift === 'ì˜¤í›„' ? ' active-orange' : '');
        document.getElementById('tang2').className = 'btn-toggle' + (selectedTang === 2 ? ' active-gray' : '');
        document.getElementById('tang3').className = 'btn-toggle' + (selectedTang === 3 ? ' active-gray' : '');
        document.getElementById('shiftLabel').style.opacity = isHoliday ? '0.3' : '1';
        document.getElementById('tangLabel').style.opacity = isHoliday ? '0.3' : '1';
    }

    function openModal(key) {
        activeKey = key;
        const data = db[key] || { isHoliday: false, shift: null, count: null, memo: '' };
        document.getElementById('modalDate').innerText = key;
        document.getElementById('isHoliday').checked = data.isHoliday;
        document.getElementById('memo').value = data.memo;
        selectedShift = data.shift;
        selectedTang = data.count;
        updateButtons();
        document.getElementById('modal').style.display = 'block';
        document.getElementById('overlay').style.display = 'block';
    }

    function closeModal() {
        document.getElementById('modal').style.display = 'none';
        document.getElementById('overlay').style.display = 'none';
    }

    function save() {
        db[activeKey] = {
            isHoliday: document.getElementById('isHoliday').checked,
            shift: selectedShift,
            count: selectedTang,
            memo: document.getElementById('memo').value
        };
        localStorage.setItem('bbanggomWorkLogV12', JSON.stringify(db));
        render();
        closeModal();
    }

    function moveMonth(offset) { viewDate.setMonth(viewDate.getMonth() + offset); render(); }
    render();
</script>
</body>
</html>
